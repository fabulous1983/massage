<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pleasure Feedback with Idea Jingle</title>
  <style>
    /* Sensual and modern colors */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1b1b1e; /* Dark sensual background */
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #ffffff;
      overflow: hidden; /* Prevent scrolling */
      user-select: none; /* Prevent text selection */
    }

    #startButton {
      background-color: #ff6473; /* Sensual red/pink button */
      color: white;
      padding: 20px 40px;
      font-size: 24px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #inputArea {
      display: none;
      width: 100vw;
      height: 100vh;
      position: absolute;
      top: 0;
      left: 0;
      background: linear-gradient(to bottom, blue, yellow, red); /* Soothing sunset gradient */
    }

    #pleasureLevel {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 36px;
      font-weight: bold;
      color: white;
    }

    #ideaMessage {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #ff6473;
      padding: 10px;
      border-radius: 10px;
      display: none;
    }

    #touchArea {
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- Start Button -->
  <button id="startButton">Start</button>

  <!-- Input Area (appears after clicking Start) -->
  <div id="inputArea">
    <div id="pleasureLevel">5</div> <!-- Default pleasure level -->
    <div id="ideaMessage">That's the spot!</div> <!-- Idea prompt -->
    <div id="touchArea"></div> <!-- Touchpad for input -->
  </div>

  <script>
    // Modular Structure
    const pleasureApp = (() => {
      let pleasureLevel = 5; // Starting level
      let maxLevel = 10;
      let minLevel = 0;
      let lastUpdate = 0; // To throttle sound updates
      const jingle = new Audio('jingle.mp3'); // Placeholder for jingle audio

      // AudioContext for humming sound
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      oscillator.type = 'sine'; // Humming sound
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      oscillator.start();

      // Haptic Feedback (Mobile Vibration API)
      const triggerHapticFeedback = () => {
        if (navigator.vibrate) {
          navigator.vibrate(50); // Basic haptic feedback (50ms)
          console.log("Haptic feedback triggered."); // Debugging: check console for this message
        } else {
          console.log("Haptic feedback not supported.");
        }
      };

      // Pause and Resume Humming Sound
      const pauseHumming = () => {
        gainNode.gain.setValueAtTime(0, audioContext.currentTime); // Silence the sound
      };

      const resumeHumming = () => {
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime); // Resume sound with low volume
      };

      // Show Input Area
      const startExperience = () => {
        document.getElementById('startButton').style.display = 'none';
        document.getElementById('inputArea').style.display = 'block';
        audioContext.resume(); // Start audio context on user interaction
      };

      // Update Pleasure Level and UI with throttling
      const updatePleasureLevel = (newLevel) => {
        const now = Date.now();
        if (now - lastUpdate > 100) { // Throttle update to every 100ms to avoid "knistern"
          lastUpdate = now;
          if (newLevel >= minLevel && newLevel <= maxLevel) {
            pleasureLevel = newLevel;
            document.getElementById('pleasureLevel').innerText = newLevel;
            triggerHapticFeedback();

            // Adjust the pitch of the humming sound based on pleasure level
            const newFrequency = 300 + (newLevel * 20); // Subtle pitch changes (range: 300-500 Hz)
            oscillator.frequency.setValueAtTime(newFrequency, audioContext.currentTime);
          }
        }
      };

      // Handle Sliding Input
      const handleInput = (e) => {
        const screenHeight = window.innerHeight;
        const touchY = e.touches[0].clientY;

        // Calculate new level based on touch position, 0 at 25% from bottom, 10 at 25% from top
        const newLevel = Math.round(((screenHeight * 0.75 - touchY) / (screenHeight * 0.5)) * maxLevel);
        updatePleasureLevel(newLevel);
      };

      // Handle Double-click to Show "That's the Spot" and Play Jingle
      const handleDoubleClick = () => {
        jingle.play();
        document.getElementById('ideaMessage').style.display = 'block'; // Show idea prompt
        setTimeout(() => {
          document.getElementById('ideaMessage').style.display = 'none';
        }, 5000); // Hide the prompt after 5 seconds
      };

      // Prevent page pull-to-refresh behavior on iPhone
      document.addEventListener('touchmove', (e) => {
        e.preventDefault(); // Disable page scrolling
      }, { passive: false });

      // Event Listeners Setup
      const initListeners = () => {
        const touchArea = document.getElementById('touchArea');

        // Track finger movements for sliding input
        touchArea.addEventListener('touchmove', handleInput);

        // Handle double-click for jingle and "That's the spot"
        document.addEventListener('dblclick', handleDoubleClick);
      };

      return {
        startExperience,
        initListeners
      };
    })();

    // Initialize Event Listeners on Start Button Click
    document.getElementById('startButton').addEventListener('click', () => {
      pleasureApp.startExperience();
      pleasureApp.initListeners();
    });

  </script>
</body>
</html>
